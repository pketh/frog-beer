// Generated by CoffeeScript 1.9.0
(function() {
  var EMAIL_INPUT, NICKNAME_INPUT, addErrorsToEmptyFields, clearFieldErrors, showSuccess, submitSignUpForm;

  EMAIL_INPUT = $('input[name="email"]');

  NICKNAME_INPUT = $('input[name="nickname"]');

  showSuccess = function(nickname) {
    $('.signup').addClass('hidden');
    $('.email-output').text(nickname);
    return $('.signup-success').removeClass('hidden');
  };

  submitSignUpForm = function(email, nickname) {
    return $.ajax({
      url: '/new-sign-up',
      type: 'POST',
      data: {
        'email': email,
        'nickname': nickname
      },
      success: function(response) {
        return showSuccess(nickname);
      }
    });
  };

  $('form.sign-up').submit(function(event) {
    var email, nickname;
    event.preventDefault();
    email = EMAIL_INPUT.val().trim();
    nickname = NICKNAME_INPUT.val().trim();
    if (email && nickname) {
      return $.ajax({
        url: '/is-valid-email',
        type: 'POST',
        data: {
          'email': email
        },
        success: function(isValidEmail) {
          console.log(isValidEmail);
          if (isValidEmail === true) {
            clearFieldErrors();
            return submitSignUpForm(email, nickname);
          } else {
            EMAIL_INPUT.addClass('error');
            return false;
          }
        }
      });
    } else {
      clearFieldErrors();
      return addErrorsToEmptyFields(email, nickname);
    }
  });

  addErrorsToEmptyFields = function(email, nickname) {
    if (!email) {
      EMAIL_INPUT.addClass('error');
    }
    if (!name) {
      return NICKNAME_INPUT.addClass('error');
    }
  };

  clearFieldErrors = function() {
    EMAIL_INPUT.removeClass('error');
    return NICKNAME_INPUT.removeClass('error');
  };

}).call(this);
