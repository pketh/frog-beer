// Generated by CoffeeScript 1.9.0
(function() {
  var EMAIL_UNSUBSCRIBE_INPUT, clearError, showUnsubscribeError, showUnsubscribeSuccess, submitUnsubscribeForm;

  EMAIL_UNSUBSCRIBE_INPUT = $('.unsubscribe-form input[name="email"]');

  showUnsubscribeSuccess = function(nickname) {
    $('.unsubscribe').addClass('hidden');
    return $('.unsubscribe-success').removeClass('hidden');
  };

  showUnsubscribeError = function() {
    return EMAIL_UNSUBSCRIBE_INPUT.addClass('error');
  };

  clearError = function() {
    return EMAIL_UNSUBSCRIBE_INPUT.removeClass('error');
  };

  submitUnsubscribeForm = function(email) {
    return $.ajax({
      url: '/unsubscribe',
      type: 'POST',
      data: {
        'email': email
      },
      success: function(response) {
        return showUnsubscribeSuccess();
      },
      error: function(response) {
        return showUnsubscribeError();
      }
    });
  };

  $('.unsubscribe-form').submit(function(event) {
    var email;
    event.preventDefault();
    email = EMAIL_UNSUBSCRIBE_INPUT.val().trim();
    if (email) {
      return $.ajax({
        url: '/is-valid-email',
        type: 'POST',
        data: {
          'email': email
        },
        success: function(isValidEmail) {
          if (isValidEmail) {
            clearError();
            return submitUnsubscribeForm(email);
          } else {
            return showUnsubscribeError();
          }
        }
      });
    } else {
      return showUnsubscribeError();
    }
  });

}).call(this);
